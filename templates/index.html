<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OllamaChat</title>
    <link rel="icon" href="https://i.postimg.cc/Y92j2b0C/6bd08d0af44a5eff0bf3c2de130be576.png" type="image/png">
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-image: url('https://i.postimg.cc/h47SH4Rv/image.png');
            background-size: cover;
            background-position: center;
            color: #fff;
            transition: background-color 0.3s, color 0.3s;
        }
        #chat-container {
            width: 60%;
            margin: 20px auto;
            height: 90vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            transition: background-color 0.3s;
        }
        #chat-log {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 10px;
            padding: 5px;
            border: 1px solid #eee;
            background-color: rgba(3, 82, 45, 0.1);
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        #input-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #user-input {
            flex-grow: 1;
            padding: 8px;
            border-radius: 5px;
            border: none;
        }
        #send-button, #file-button, #clearChat, #theme-toggle {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 5px;
            border: none;
            background-color: #28a745;
            color: white;
        }
        #emoji-buttons {
            display: flex;
            gap: 5px;
        }
        h1 {
            text-align: center;
            color: #fff;
        }
    </style>
</head>
<body>
    <div id="chat-container"> <h1>–¢—É—Ä. –∞–≥–µ–Ω—Ç –°–∞—è—Ö

    </h1> 
    <div id="chat-log"></div> 
    <div id="input-container"> 
        <button id="theme-toggle">–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</button>
        <input type="text" id="user-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."> 
        <div id="emoji-buttons"> 
            <button class="emoji-button" data-emoji="üòä">üòä</button> 
            <button class="emoji-button" data-emoji="üò¢">üò¢</button> 
            <button class="emoji-button" data-emoji="üòç">üòç</button> 
            <button class="emoji-button" data-emoji="üòÇ">üòÇ</button> 
            <button class="emoji-button" data-emoji="üëç">üëç</button> 
        </div> <button id="send-button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button> 
        <input type="file" id="file-input">
        <button id="file-button">–§–∞–π–ª</button> 
        <button id="clearChat">–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç</button> 
        </div>
    </div>
    <script>
        const chatLog = document.getElementById("chat-log");
        const userInput = document.getElementById("user-input");
        const sendButton = document.getElementById("send-button");
        const emojiButtons = document.querySelectorAll(".emoji-button");
        const fileInput = document.getElementById("file-input");
        const fileButton = document.getElementById("file-button");
        const clearChatButton = document.getElementById("clearChat");
        const themeToggleButton = document.getElementById("theme-toggle");

        let currentTheme = 'blue'; // –°–∏–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–º–µ–Ω—ã —Ç–µ–º—ã
        function toggleTheme() {
    if (currentTheme === 'blue') {
        document.body.style.backgroundImage = "url('https://i.postimg.cc/XJ5938B2/image.png')";
        document.body.style.color = "#fff"; // –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã
        chatLog.style.backgroundColor = "rgba(0, 162, 255, 0.1)"; // –°–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π –¥–ª—è –ª–æ–≥–æ–≤
        currentTheme = 'pink'; // –ú–µ–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Ç–µ–º—É –Ω–∞ —Ä–æ–∑–æ–≤—É—é
    } else if (currentTheme === 'pink') {
        document.body.style.backgroundImage = "url('https://i.postimg.cc/KY6g9Mpt/image.png')";
        document.body.style.color = "#fff"; // –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
        chatLog.style.backgroundColor = "rgba(96, 8, 110, 0.1)"; // –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π –¥–ª—è –ª–æ–≥–æ–≤
        currentTheme = 'green'; // –ú–µ–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Ç–µ–º—É –Ω–∞ –∑–µ–ª–µ–Ω—É—é
    } else {
        document.body.style.backgroundImage = "url('https://i.postimg.cc/h47SH4Rv/image.png')"; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ URL –≤–∞—à–µ–π –∑–µ–ª–µ–Ω–æ–π —Ç–µ–º—ã
        document.body.style.color = "#fff"; // –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∑–µ–ª–µ–Ω–æ–π —Ç–µ–º—ã
        chatLog.style.backgroundColor = "rgba(0, 255, 0, 0.1)"; // –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π –¥–ª—è –ª–æ–≥–æ–≤
        currentTheme = 'blue'; // –ú–µ–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Ç–µ–º—É –Ω–∞ —Å–∏–Ω—é—é
    }
}


        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ localStorage –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            const savedMessages = JSON.parse(localStorage.getItem("chatMessages")) || [];
            savedMessages.forEach(message => appendMessage(message));
        };

        sendButton.addEventListener("click", sendMessage);
        userInput.addEventListener("keydown", function(event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        });

        emojiButtons.forEach(button => {
            button.addEventListener("click", function() {
                const emoji = button.getAttribute("data-emoji");
                userInput.value += emoji;
            });
        });

        fileButton.addEventListener("click", function() {
            fileInput.click();
        });

        fileInput.addEventListener("change", function() {
            const file = fileInput.files[0];
            if (file) {
                const formData = new FormData();
                formData.append("file", file);

                fetch("/api/upload", {
                    method: "POST",
                    body: formData
                }).then(response => response.json())
                .then(data => {
                    appendMessage("–í—ã: " + data.fileUrl);
                }).catch(error => {
                    console.error("–û—à–∏–±–∫–∞:", error);
                    appendMessage("–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª.");
                });
            }
        });

        clearChatButton.addEventListener("click", function() {
            chatLog.innerHTML = "";
            localStorage.removeItem("chatMessages");
            appendMessage("Ollama: –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –æ—á–∏—â–µ–Ω–∞.");
        });

        themeToggleButton.addEventListener("click", toggleTheme);

        function appendMessage(message) {
            const messageElement = document.createElement("p");
            messageElement.textContent = message;
            chatLog.appendChild(messageElement);
            chatLog.scrollTop = chatLog.scrollHeight; // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞
        }

        function saveMessage(message) {
            const savedMessages = JSON.parse(localStorage.getItem("chatMessages")) || [];
            savedMessages.push(message);
            localStorage.setItem("chatMessages", JSON.stringify(savedMessages));
        }

        function sendMessage() {
            const message = userInput.value.trim();
            if (message) {
                appendMessage("–í—ã: " + message);
                saveMessage("–í—ã: " + message); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                userInput.value = "";
                processMessage(message);
            }
        }

        function processMessage(message) {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
            const rememberMatch = message.match(/–∑–∞–ø–æ–º–Ω–∏ (\w+)/);
            if (rememberMatch) {
                const itemToRemember = rememberMatch[1];
                memory[itemToRemember] = itemToRemember; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                appendMessage("Ollama: –Ø –∑–∞–ø–æ–º–Ω–∏–ª–∞ " + itemToRemember + ".");
                saveMessage("Ollama: –Ø –∑–∞–ø–æ–º–Ω–∏–ª–∞ " + itemToRemember + "."); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å –æ –∑–∞–ø–æ–º–Ω–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            const recallMatch = message.match(/—á—Ç–æ —Ç–∞–∫–æ–µ (\w+)/);
            if (recallMatch) {
                const itemToRecall = recallMatch[1];
                if (memory[itemToRecall]) {
                    appendMessage("Ollama: " + memory[itemToRecall]);
                    saveMessage("Ollama: " + memory[itemToRecall]); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
                } else {
                    appendMessage("Ollama: –Ø –Ω–µ –ø–æ–º–Ω—é, —á—Ç–æ —Ç–∞–∫–æ–µ " + itemToRecall + ".");
                    saveMessage("Ollama: –Ø –Ω–µ –ø–æ–º–Ω—é, —á—Ç–æ —Ç–∞–∫–æ–µ " + itemToRecall + "."); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
                }
                return;
            }

            // –õ–æ–≥–∏–∫–∞ –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –û–ª–ª–∞–º–æ–π
            fetch("/api/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: message })
            }).then(response => response.json())
            .then(data => {
                appendMessage("Ollama: " + data.response);
                saveMessage("Ollama: " + data.response); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
            }).catch(error => {
                console.error("–û—à–∏–±–∫–∞:", error);
                appendMessage("Ollama: –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.");
            });
        }
    </script>
</body>
</html>

